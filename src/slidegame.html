<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Babylon.js - Slide as Ground</title>
    <script type="module">
        import * as BABYLON from "https://cdn.jsdelivr.net/npm/@babylonjs/core@5.0.0/index.min.js";
        import "https://cdn.jsdelivr.net/npm/@babylonjs/loaders@5.0.0/index.min.js";

        async function createScene(engine, canvas) {
            const scene = new BABYLON.Scene(engine);

            // Enable physics with Cannon.js
            const gravityVector = new BABYLON.Vector3(0, -9.81, 0);
            const physicsPlugin = new BABYLON.CannonJSPlugin();
            scene.enablePhysics(gravityVector, physicsPlugin);

            // Create camera
            const camera = new BABYLON.ArcRotateCamera(
                "camera",
                -Math.PI / 2,
                Math.PI / 3,
                50,
                BABYLON.Vector3.Zero(),
                scene
            );
            camera.attachControl(canvas, true);

            // Add a hemispheric light
            const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);
            light.intensity = 0.7;

            // Load slide.glb as ground
            const container = await BABYLON.SceneLoader.LoadAssetContainerAsync(
                "src/assets/glb/slide.glb", // Replace with your actual path
                "",
                scene
            );

            const slide = container.meshes[0]; // Ensure this references the correct mesh
            if (slide) {
                slide.scaling = new BABYLON.Vector3(10, 10, 10); // Scale the slide
                slide.position.y = 0; // Align to ground level
                slide.physicsImpostor = new BABYLON.PhysicsImpostor(
                    slide,
                    BABYLON.PhysicsImpostor.MeshImpostor,
                    { mass: 0, friction: 0.8, restitution: 0.5 },
                    scene
                );

                container.addAllToScene();
                console.log("Slide successfully loaded and configured.");
            } else {
                console.error("Slide mesh not found in the container.");
            }

            // Create marbles
            for (let i = 0; i < 4; i++) {
                const marble = BABYLON.MeshBuilder.CreateSphere(`marble${i}`, { diameter: 1 }, scene);
                marble.position = new BABYLON.Vector3(-3 + i * 2, 5, 0);
                marble.physicsImpostor = new BABYLON.PhysicsImpostor(
                    marble,
                    BABYLON.PhysicsImpostor.SphereImpostor,
                    { mass: 1, friction: 0.2, restitution: 0.7 },
                    scene
                );
            }

            return scene;
        }

        // Set up the Babylon.js engine and canvas
        const canvas = document.getElementById("renderCanvas");
        const engine = new BABYLON.Engine(canvas, true);

        // Create and render the scene
        createScene(engine, canvas).then((scene) => {
            engine.runRenderLoop(() => {
                scene.render();
            });
        });

        // Handle window resize
        window.addEventListener("resize", () => {
            engine.resize();
        });
    </script>
    <style>
        html, body {
            overflow: hidden;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
    </style>
</head>
<body>
    <canvas id="renderCanvas"></canvas>
</body>
</html>
